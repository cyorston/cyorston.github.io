<script>
// Skills + project data
const skillsData = [
  {name:"Python", group:"Programming"},
  {name:"R", group:"Programming"},
  {name:"SQL", group:"Programming"},
  {name:"Power BI", group:"Analytics"},
  {name:"Azure", group:"Analytics"},
  {name:"AWS", group:"Analytics"},
  {name:"PySpark", group:"Programming"},
  {name:"D3.js", group:"Visualization"},
  {name:"Bayesian Modeling", group:"Modeling"},
  {name:"Machine Learning", group:"Modeling"},
  {name:"IoT Analytics", group:"Analytics"}
];
const groupColors = {
  Programming: 0xff6666,
  Analytics: 0x66ff66,
  Visualization: 0x66ccff,
  Modeling: 0xffcc66
};
const projects = [
  { title:"CFB 5B Power Rankings", description:"Predicts college football matchups using Python, ML, SQL." },
  { title:"Trendiment", description:"BERT models fine-tuned with Python for sentiment analysis, visualized via Power BI." },
  { title:"BayesBall Assistant", description:"Bayesian hierarchical model using Python and Bayesian Modeling." }
];

// Three.js globe setup
const container = document.getElementById("skillsGlobe");
const popup = document.getElementById("skillPopup");
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(50, container.clientWidth/container.clientHeight, 0.1, 1000);
camera.position.z = 50;

const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enableZoom = true;

// Sphere (just a blank sphere for skills)
const sphereGeometry = new THREE.SphereGeometry(20, 32, 32);
const sphereMaterial = new THREE.MeshBasicMaterial({color: 0x0d1117, wireframe: true});
const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
scene.add(sphere);

// Create skill points
const skillObjects = [];
skillsData.forEach((skill,i)=>{
  const phi = Math.acos(-1 + (2*i)/skillsData.length);
  const theta = Math.sqrt(skillsData.length * Math.PI) * phi;

  const x = 20 * Math.cos(theta) * Math.sin(phi);
  const y = 20 * Math.sin(theta) * Math.sin(phi);
  const z = 20 * Math.cos(phi);

  const geometry = new THREE.SphereGeometry(1.2, 12, 12);
  const material = new THREE.MeshBasicMaterial({color: groupColors[skill.group]});
  const skillMesh = new THREE.Mesh(geometry, material);
  skillMesh.position.set(x,y,z);
  skillMesh.userData = {skill: skill};
  scene.add(skillMesh);
  skillObjects.push(skillMesh);
});

// Raycaster for click detection
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

function onMouseClick(event){
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = - ((event.clientY - rect.top) / rect.height) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(skillObjects);
  if(intersects.length > 0){
    const skill = intersects[0].object.userData.skill;
    popup.style.display = "block";
    popup.style.left = event.clientX + "px";
    popup.style.top = event.clientY + "px";
    const related = projects.filter(p=>p.description.toLowerCase().includes(skill.name.toLowerCase()));
    popup.innerHTML = `<strong>${skill.name}</strong><br>` + (related.length ? related.map(p=>`â€¢ ${p.title}`).join("<br>") : "No projects found for this skill.");
  } else {
    popup.style.display = "none";
  }
}

window.addEventListener("click", onMouseClick);

// Animation loop
function animate(){
  requestAnimationFrame(animate);
  sphere.rotation.y += 0.002;
  skillObjects.forEach(s=>{ s.rotation.y += 0.002; });
  controls.update();
  renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', ()=>{
  camera.aspect = container.clientWidth/container.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(container.clientWidth, container.clientHeight);
});
</script>
